# 	é»‘é©¬é¢é¢-ç¬¬äº”å¤©

## å°ç¨‹åºåŸºç¡€

### ç›®æ ‡

* äº†è§£ä»€ä¹ˆæ˜¯å¾®ä¿¡å°ç¨‹åº
* å°ç¨‹åºå¼€å‘çš„å‡†å¤‡å·¥ä½œ
* å®‰è£…å¾®ä¿¡å¼€å‘è€…å·¥å…·
* ç¬¬ä¸€ä¸ªå°ç¨‹åºä½“éªŒ

### è®²è§£

![01.ä¸åŒå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„äº¤äº’æ¨¡å¼](D:\Javaç¬”è®°_Typora\æˆ‘æ·»åŠ çš„img\01.ä¸åŒå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„äº¤äº’æ¨¡å¼.png)

#### ä»€ä¹ˆæ˜¯å¾®ä¿¡å°ç¨‹åº

* å¾®ä¿¡å°ç¨‹åºï¼Œç®€ç§°å°ç¨‹åºï¼Œè‹±æ–‡åMini Program
* æ˜¯ä¸€ç§ä¸éœ€è¦ä¸‹è½½å®‰è£…å³å¯ä½¿ç”¨çš„åº”ç”¨ï¼Œå®ƒå®ç°äº†åº”ç”¨â€œè§¦æ‰‹å¯åŠâ€çš„æ¢¦æƒ³ï¼Œç”¨æˆ·æ‰«ä¸€æ‰«æˆ–æœä¸€ä¸‹å³å¯æ‰“å¼€åº”ç”¨ã€‚ 

* å°ç¨‹åºå¼€å‘ï¼Œéœ€è¦ç»è¿‡ï¼šç”³è¯·å°ç¨‹åºå¼€å‘è€…å¸å·->å®‰è£…å¾®ä¿¡å¼€å‘è€…å·¥å…·->é…ç½®é¡¹ç›®ç­‰ç­‰è¿‡ç¨‹æ–¹å¯å®Œæˆã€‚
* å¼€å‘è€…æ–‡æ¡£ https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/ 

#### ç”³è¯·å°ç¨‹åºå¸å·(å¾—åˆ°AppID)

##### è¯´æ˜

* å¼€å‘å°ç¨‹åºçš„ç¬¬ä¸€æ­¥ï¼Œéœ€è¦æ‹¥æœ‰ä¸€ä¸ªå°ç¨‹åº AppIDï¼ˆå¼€å‘è€…IDï¼‰ï¼Œç›¸å½“äºå¼€å‘è€…åœ¨å°ç¨‹åºå¹³å°çš„èº«ä»½è¯ã€‚
* åç»­çš„æ‰€æœ‰å°ç¨‹åºå¼€å‘æµç¨‹ä¼šåŸºäºè¿™ä¸ª AppID æ¥å®Œæˆã€‚
* å°ç¨‹åºçš„æ³¨å†Œéå¸¸ç®€å•ï¼Œåªéœ€å‡ ä¸ªæ“ä½œã€‚

##### æ­¥éª¤

###### 1. æ‰“å¼€æ³¨å†Œé¡µé¢

* ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ <https://mp.weixin.qq.com/>ï¼Œç‚¹å‡»â€œç«‹å³æ³¨å†Œâ€

![image-20200308152909239](./æ€»img/æ¡†æ¶7/image-20200308152909239.png)

###### 2. é€‰æ‹©æ³¨å†Œçš„ç±»å‹

* é€‰æ‹©â€œå°ç¨‹åºâ€

![image-20200308153004473](./æ€»img/æ¡†æ¶7/image-20200308153004473.png)

###### 3. æ³¨å†Œå¹¶æ¿€æ´»å¸å·

* è¾“å…¥ä¿¡æ¯ï¼Œç‚¹å‡»â€œæ³¨å†Œâ€ã€‚
* æ³¨æ„ï¼š**æ³¨å†Œåï¼Œè¯·ç™»å½•è‡ªå·±é‚®ä»¶ï¼Œæ¿€æ´»å¸å·**

![image-20200308153213779](./æ€»img/æ¡†æ¶7/image-20200308153213779.png)

###### 4. ç™»è®°ä¸ªäººä¿¡æ¯

* æ¿€æ´»å¸å·åï¼Œè¦ç™»è®°ä¸ªäººä¿¡æ¯ï¼Œå¹¶ä¸”**è¦æ‰«ç ç»‘å®šä¸€ä¸ªå¾®ä¿¡å·**ä½œä¸ºç®¡ç†å‘˜ã€‚
* æœ€åç‚¹å‡»â€œç¡®å®šâ€ï¼Œâ€œå‰å¾€å°ç¨‹åºâ€

![image-20200308154009463](./æ€»img/æ¡†æ¶7/image-20200308154009463.png)

* ç™»è®°ä¹‹åï¼Œä¼šæ˜¾ç¤ºå°ç¨‹åºçš„åå°ç®¡ç†é¦–é¡µ

![image-20200308154733377](./æ€»img/æ¡†æ¶7/image-20200308154733377.png)

###### 5. æŸ¥çœ‹AppIDå’ŒAppSecret

1. åœ¨å·¦ä¾§ç‚¹å‡»â€œå¼€å‘â€ï¼Œç„¶åâ€œå¼€å‘è®¾ç½®â€ï¼Œç‚¹å‡»â€œç”Ÿæˆâ€

![image-20200308155148815](./æ€»img/æ¡†æ¶7/image-20200308155148815.png)

2. ç”¨åˆšåˆšç»‘å®šçš„å¾®ä¿¡å·ï¼Œæ‰«ç ç¡®è®¤åï¼Œä¼šå¼¹å‡ºçª—å£ï¼Œæ˜¾ç¤ºAppSecretã€‚æŠŠä½ çš„AppIDå’ŒAppSecretè®°å½•ä¸‹æ¥

![image-20200308155408395](./æ€»img/æ¡†æ¶7/image-20200308155408395.png)

###### 6. å¦‚æœå¿˜è®°äº†AppSecretæ€ä¹ˆåŠï¼Ÿ

* æ‰“å¼€https://mp.weixin.qq.com/ï¼Œç™»å½•åˆšåˆšæ³¨å†Œçš„å°ç¨‹åºå¸å·
* æ‰¾åˆ°å·¦ä¾§èœå•â€œå¼€å‘â€ï¼Œç‚¹å‡»â€œå¼€å‘è®¾ç½®â€ï¼Œç‚¹å‡»â€œé‡ç½®â€

![image-20200308155928379](./æ€»img/æ¡†æ¶7/image-20200308155928379.png)

#### å®‰è£…å¾®ä¿¡å¼€å‘è€…å·¥å…·

* ä¸‹è½½é“¾æ¥ï¼š <https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html> 
* æ ¹æ®è‡ªå·±çš„æ“ä½œç³»ç»Ÿä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…è¿›è¡Œå®‰è£…ã€‚ æ³¨æ„:
  * å°ç¨‹åºå¼€å‘å·¥å…·åœ¨ Windowsä¸Šä»…æ”¯æŒ Windows 7 åŠä»¥ä¸Šç‰ˆ
  * åœ¨ Mac ä¸Šæ”¯æŒ OS X 10.8 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚
* Windows ä¸Šï¼ŒåŒå‡»ä¸‹è½½å®Œæˆçš„å®‰è£…æ–‡ä»¶ï¼Œæ ¹æ®æç¤ºç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œå³å¯å®Œæˆå®‰è£…ã€‚
* å®‰è£…æˆåŠŸåï¼Œå¯ä»¥åœ¨æ¡Œé¢æˆ–è€…å¼€å§‹èœå•ä¸­æ‰¾åˆ°å°ç¨‹åºå¼€å‘å·¥å…·çš„å¿«æ·æ–¹å¼ï¼Œæ‰“å¼€å³å¯

#### ç¬¬ä¸€ä¸ªå°ç¨‹åºä½“éªŒ

##### 1. å¯åŠ¨å¾®ä¿¡å¼€å‘è€…è€…å·¥å…·ï¼Œæ‰«ç ç™»å½•

![image-20200308163145778](./æ€»img/æ¡†æ¶7/image-20200308163145778.png)

##### 2. æ–°å»ºå°ç¨‹åº

![image-20200308163551339](./æ€»img/æ¡†æ¶7/image-20200308163551339.png)

![image-20200308164256844](./æ€»img/æ¡†æ¶7/image-20200308164256844.png)

![image-20200308165217875](./æ€»img/æ¡†æ¶7/image-20200308165217875.png)

##### 3. é¢„è§ˆå°ç¨‹åºæ•ˆæœ

###### å¯ä»¥åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·é‡Œé¢„è§ˆ

* å·¦è¾¹çª—å£ï¼Œæ˜¯é¢„è§ˆæ•ˆæœ

![image-20200308170534233](./æ€»img/æ¡†æ¶7/image-20200308170534233.png)

###### å¯ä»¥åœ¨æ‰‹æœºå¾®ä¿¡ä¸Šé¢„è§ˆ

* è‡ªå·±é¢„è§ˆ

![image-20200308170640906](./æ€»img/æ¡†æ¶7/image-20200308170640906.png)

* å¦‚æœæƒ³è¦å…¶å®ƒå¾®ä¿¡å·é¢„è§ˆï¼Œå°±æ‰“å¼€  <https://mp.weixin.qq.com/>ï¼Œç™»å½•ä¹‹åï¼Œåœ¨æˆå‘˜ç®¡ç†é‡Œæ·»åŠ é¡¹ç›®æˆå‘˜ï¼Œæœ€å¤šæ·»åŠ 15äºº

![image-20200308171103679](./æ€»img/æ¡†æ¶7/image-20200308171103679.png)

![image-20201024090230274](./æ€»img/æ¡†æ¶7/image-20201024090230274.png)

### å°ç»“



## å°ç¨‹åºä»‹ç»

### ç›®æ ‡

* äº†è§£å¾®ä¿¡å°ç¨‹åºä»£ç ç»“æ„

### è®²è§£

ä¸€ä¸ªå°ç¨‹åºåŒ…å«ï¼š

* æè¿°æ•´ä½“ç¨‹åºçš„`app`
* æè¿°æ¯ä¸ªé¡µé¢çš„`page`

![image-20200308213023394](./æ€»img/æ¡†æ¶7/image-20200308213023394.png)

* ä¸€ä¸ªå°ç¨‹åºä¸»ä½“éƒ¨åˆ†ç”±ä¸‰ä¸ªæ–‡ä»¶ç»„æˆï¼Œå¿…é¡»æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¦‚ä¸‹ï¼š

| æ–‡ä»¶     | å¿…éœ€ | ä½œç”¨             |
| -------- | :--- | :--------------- |
| app.js   | æ˜¯   | å°ç¨‹åºé€»è¾‘       |
| app.json | æ˜¯   | å°ç¨‹åºå…¬å…±é…ç½®   |
| app.wxss | å¦   | å°ç¨‹åºå…¬å…±æ ·å¼è¡¨ |

* ä¸€ä¸ªå°ç¨‹åºé¡µé¢ç”±å››ä¸ªæ–‡ä»¶ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š

| æ–‡ä»¶ç±»å‹ | å¿…éœ€ | ä½œç”¨                  |
| -------- | :--- | :-------------------- |
| js       | æ˜¯   | é¡µé¢é€»è¾‘              |
| wxml     | æ˜¯   | é¡µé¢ç»“æ„ï¼Œç›¸å½“äºhtml  |
| json     | å¦   | é¡µé¢é…ç½®              |
| wxss     | å¦   | é¡µé¢æ ·å¼è¡¨ï¼Œç›¸å½“äºcss |

* **æ³¨æ„ï¼šä¸ºäº†æ–¹ä¾¿å¼€å‘è€…å‡å°‘é…ç½®é¡¹ï¼Œæè¿°é¡µé¢çš„å››ä¸ªæ–‡ä»¶å¿…é¡»å…·æœ‰ç›¸åŒçš„è·¯å¾„ä¸æ–‡ä»¶åã€‚**

#### å°ç¨‹åºçš„å…¨å±€é…ç½®

##### `app.json`

â€‹		å½“å‰å°ç¨‹åºçš„æ•´ä½“é…ç½®ï¼ŒåŒ…æ‹¬äº†å°ç¨‹åºçš„æ‰€æœ‰é¡µé¢è·¯å¾„ã€ç•Œé¢è¡¨ç°ã€ç½‘ç»œè¶…æ—¶æ—¶é—´ã€åº•éƒ¨ tab ç­‰ã€‚ç¬¬ä¸€ä¸ªç¨‹åºçš„app.jsoné…ç½®å¦‚å›¾æ‰€ç¤ºï¼š

```json
{
  "pages": [
    "pages/index/index",
    "pages/logs/logs"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "WeChat",
    "navigationBarTextStyle": "black"
  },
  "style": "v2",
  "sitemapLocation": "sitemap.json"
}
```

* `pages`ï¼š
  * ç”¨äºæè¿°å½“å‰å°ç¨‹åºæ‰€æœ‰é¡µé¢è·¯å¾„ï¼Œè¿™æ˜¯ä¸ºäº†è®©å¾®ä¿¡å®¢æˆ·ç«¯çŸ¥é“å½“å‰ä½ çš„å°ç¨‹åºé¡µé¢å®šä¹‰åœ¨å“ªä¸ªç›®å½•ã€‚
  * ç¬¬ä¸€ä¸ªå€¼ï¼Œæ˜¯å°ç¨‹åºçš„é»˜è®¤é¡µé¢
* `window`ï¼š
  * å®šä¹‰å°ç¨‹åºæ‰€æœ‰é¡µé¢çš„é¡¶éƒ¨èƒŒæ™¯é¢œè‰²ï¼Œæ–‡å­—é¢œè‰²å®šä¹‰ç­‰ã€‚

##### `project.config.json`

â€‹		æ˜¯å½“å‰å°ç¨‹åºçš„é¡¹ç›®é…ç½®ï¼Œåœ¨æ¯ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•éƒ½ä¼šç”Ÿè‡ªåŠ¨æˆä¸€ä¸ª `project.config.json`ï¼Œä½ åœ¨å¼€å‘å·¥å…·ä¸Šåšçš„ä»»ä½•é…ç½®éƒ½ä¼šå†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚

â€‹		å½“ä½ é‡æ–°å®‰è£…å·¥å…·æˆ–è€…æ¢ç”µè„‘å·¥ä½œæ—¶ï¼Œä½ åªè¦è½½å…¥åŒä¸€ä¸ªé¡¹ç›®çš„ä»£ç åŒ…ï¼Œå¼€å‘è€…å·¥å…·å°±è‡ªåŠ¨ä¼šå¸®ä½ æ¢å¤åˆ°å½“æ—¶ä½ å¼€å‘é¡¹ç›®æ—¶çš„ä¸ªæ€§åŒ–é…ç½®ï¼Œå…¶ä¸­ä¼šåŒ…æ‹¬ç¼–è¾‘å™¨çš„é¢œè‰²ã€ä»£ç ä¸Šä¼ æ—¶è‡ªåŠ¨å‹ç¼©ç­‰ç­‰ä¸€ç³»åˆ—é€‰é¡¹ã€‚

â€‹		ä¸€èˆ¬æ— éœ€å¼€å‘è€…ä¿®æ”¹ã€‚

##### `app.wxss`

å°ç¨‹åºçš„å…¨å±€æ ·å¼ï¼Œæ¯ä¸ªé¡µé¢éƒ½ä¼šè‡ªåŠ¨ç»§æ‰¿å…¨å±€æ ·å¼ã€‚

##### `app.js`

â€‹		å°ç¨‹åºçš„å…¨å±€é€»è¾‘ï¼Œå…¶ä¸­å®šä¹‰äº†`App`å¯¹è±¡ï¼Œæ¯ä¸ªå°ç¨‹åºéƒ½å¿…é¡»æœ‰å”¯ä¸€çš„`App`å¯¹è±¡

â€‹		`App`å¯¹è±¡å°è£…äº†å°ç¨‹åºçš„äº‹ä»¶å¤„ç†ã€å…¨å±€æ•°æ®ã€å…¨å±€æ–¹æ³•ã€‚å°ç¨‹åºé‡Œæ¯ä¸ªé¡µé¢éƒ½å¯ä»¥è·å–åˆ°è¿™ä¸ª`App`å¯¹è±¡ï¼Œè°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ã€æ“ä½œå…¶ä¸­çš„æ•°æ®

```js
//App: å°ç¨‹åºå¯¹è±¡ã€‚ä¸€ä¸ªå°ç¨‹åºåªæœ‰ä¸€ä¸ªAppå¯¹è±¡
//     åœ¨å°ç¨‹åºé‡Œä»»ä½•é¡µé¢ä¸­ï¼Œéƒ½å¯ä»¥è·å–åˆ°è¿™ä¸ªAppå¯¹è±¡ï¼Œå¹¶è°ƒç”¨Appå¯¹è±¡é‡Œçš„æ–¹æ³•ã€æ“ä½œAppå¯¹è±¡é‡Œçš„æ•°æ®
App({
  onLaunch: function () {
    
  },
  globalData: {
    userInfo: null
  }
})
```

#### å°ç¨‹åºçš„é¡µé¢

å°ç¨‹åºé‡Œä¸€ä¸ªé¡µé¢åŒ…å«ä»¥ä¸‹å››é¡¹ï¼š

| æ–‡ä»¶ç±»å‹ | èŒè´£                                           |
| -------- | ---------------------------------------------- |
| wxml     | ç›¸å½“äºhtmlï¼Œç”¨äºç¼–å†™æœ¬é¡µé¢ä¸Šè¦æ˜¾ç¤ºçš„å†…å®¹       |
| wxss     | ç›¸å½“äºcssï¼Œç”¨äºä¿®é¥°æœ¬é¡µé¢çš„æ ·å¼                |
| js       | æœ¬é¡µé¢çš„é€»è¾‘å¤„ç†ï¼Œç”¨äºå’Œç”¨æˆ·äº¤äº’ï¼Œå®ç°åŠ¨æ€æ•ˆæœ |
| json     | æœ¬é¡µé¢çš„çª—å£é…ç½®[ç±»ä¼¼äºå¸ƒå±€]                   |

##### WXMLæ¨¡æ¿

*  `WXML` å……å½“çš„å°±æ˜¯ç±»ä¼¼ `HTML` çš„è§’è‰²ï¼Œä¹Ÿæœ‰æ ‡ç­¾å’Œå±æ€§ã€‚
* æ›´è¯¦ç»†çš„æ–‡æ¡£å¯ä»¥å‚è€ƒ [WXML](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/)

```html
<text>textæ ‡ç­¾ï¼Œç±»ä¼¼äºspan</text>
<text>textæ ‡ç­¾ï¼Œç±»ä¼¼äºspan</text>
<view>viewæ ‡ç­¾ï¼Œç±»ä¼¼äºdivï¼Œç‹¬å ä¸€è¡Œ</view>
<view>viewæ ‡ç­¾ï¼Œç±»ä¼¼äºdivï¼Œç‹¬å ä¸€è¡Œ</view>
<button>æŒ‰é’®</button>
```

##### WXSSæ ·å¼

* `WXSS` å…·æœ‰ `CSS` å¤§éƒ¨åˆ†çš„ç‰¹æ€§ï¼Œå°ç¨‹åºåœ¨ `WXSS` ä¹Ÿåšäº†ä¸€äº›æ‰©å……å’Œä¿®æ”¹ã€‚ä½†æ˜¯ `WXSS` ä»…æ”¯æŒéƒ¨åˆ† `CSS` é€‰æ‹©å™¨
* æ›´è¯¦ç»†çš„æ–‡æ¡£å¯ä»¥å‚è€ƒ [WXSS](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html) 

```css
/* pages/mypage/mypage.wxss */
text{
    /*textæ ‡ç­¾çš„æ ·å¼*/
	color: brown;
}
.c1{
    /*ç±»åä¸ºc1çš„æ ·å¼*/
    font-size: 25px;
}
#v1{
    /*idä¸ºv1çš„æ ·å¼*/
    font-family: 'Courier New', Courier, monospace;
    color: blue;
}
```

##### jsé€»è¾‘

* ä¸€ä¸ªæœåŠ¡ä»…ä»…åªæœ‰ç•Œé¢å±•ç¤ºæ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦å’Œç”¨æˆ·åšäº¤äº’ï¼šå“åº”ç”¨æˆ·çš„ç‚¹å‡»ã€è·å–ç”¨æˆ·çš„ä½ç½®ç­‰ç­‰ã€‚

* åœ¨å°ç¨‹åºé‡Œè¾¹ï¼Œæˆ‘ä»¬å°±é€šè¿‡ç¼–å†™ `JS` è„šæœ¬æ–‡ä»¶æ¥å¤„ç†ç”¨æˆ·çš„æ“ä½œã€‚

* æ¯”å¦‚ï¼š

  * æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»æ—¶è¦æŠŠæ˜¾ç¤ºçš„å†…å®¹æ˜¾ç¤ºæˆâ€œHello Worldâ€
  * ç»™æŒ‰é’®ç”¨`bindtap`ç»‘å®šäº‹ä»¶ï¼šè§¦æ‘¸æŒ‰é’®åç¦»å¼€ï¼Œè°ƒç”¨å‡½æ•°`clickMe`

  ```html
          <view>{{ message }}</view>
  <button bindtap="changeMessage">ç‚¹å‡»æˆ‘</button>
  ```

  * åœ¨jsæ–‡ä»¶é‡Œå£°æ˜å‡½æ•°

  ```js
  Page({
    data: {
        message:"hello"
    },
    changeMessage:function(){
      this.setData({
        message:"ä½ å¥½"
      });
    }
  })
  ```

* åœ¨ JS ä¸­è°ƒç”¨å°ç¨‹åºæä¾›çš„ä¸°å¯Œçš„ APIï¼Œåˆ©ç”¨è¿™äº› API å¯ä»¥å¾ˆæ–¹ä¾¿çš„è°ƒèµ·å¾®ä¿¡æä¾›çš„èƒ½åŠ›ï¼Œä¾‹å¦‚è·å–ç”¨æˆ·ä¿¡æ¯ã€æœ¬åœ°å­˜å‚¨ã€å¾®ä¿¡æ”¯ä»˜ç­‰ã€‚

* æ›´è¯¦ç»†çš„äº‹ä»¶å¯ä»¥å‚è€ƒæ–‡æ¡£ [WXML - äº‹ä»¶](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html) ã€‚

* æ›´å¤š API å¯ä»¥å‚è€ƒæ–‡æ¡£ [å°ç¨‹åºçš„API](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html) ã€‚

##### jsoné…ç½®

â€‹		æ¯ä¸€ä¸ªå°ç¨‹åºé¡µé¢ä¹Ÿå¯ä»¥ä½¿ç”¨ `.json` æ–‡ä»¶æ¥å¯¹æœ¬é¡µé¢çš„çª—å£è¡¨ç°è¿›è¡Œé…ç½®ã€‚é¡µé¢ä¸­é…ç½®é¡¹åœ¨å½“å‰é¡µé¢ä¼šè¦†ç›– `app.json` çš„ `window` ä¸­ç›¸åŒçš„é…ç½®é¡¹ã€‚æ–‡ä»¶å†…å®¹ä¸ºä¸€ä¸ª JSON å¯¹è±¡ï¼Œæœ‰ä»¥ä¸‹å±æ€§ï¼š

| å±æ€§                                                         | ç±»å‹     | é»˜è®¤å€¼   | æè¿°                                                         | æœ€ä½ç‰ˆæœ¬                                                     |
| :----------------------------------------------------------- | :------- | :------- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| navigationBarBackgroundColor                                 | HexColor | #000000  | å¯¼èˆªæ èƒŒæ™¯é¢œè‰²ï¼Œå¦‚ `#000000`                                 |                                                              |
| navigationBarTextStyle                                       | string   | white    | å¯¼èˆªæ æ ‡é¢˜é¢œè‰²ï¼Œä»…æ”¯æŒ `black` / `white`                     |                                                              |
| navigationBarTitleText                                       | string   |          | å¯¼èˆªæ æ ‡é¢˜æ–‡å­—å†…å®¹                                           |                                                              |
| navigationStyle                                              | string   | default  | å¯¼èˆªæ æ ·å¼ï¼Œä»…æ”¯æŒä»¥ä¸‹å€¼ï¼š `default` é»˜è®¤æ ·å¼ `custom` è‡ªå®šä¹‰å¯¼èˆªæ ï¼Œåªä¿ç•™å³ä¸Šè§’èƒ¶å›ŠæŒ‰é’® | å¾®ä¿¡å®¢æˆ·ç«¯ 7.0.0                                             |
| backgroundColor                                              | HexColor | #ffffff  | çª—å£çš„èƒŒæ™¯è‰²                                                 |                                                              |
| backgroundTextStyle                                          | string   | dark     | ä¸‹æ‹‰ loading çš„æ ·å¼ï¼Œä»…æ”¯æŒ `dark` / `light`                 |                                                              |
| backgroundColorTop                                           | string   | #ffffff  | é¡¶éƒ¨çª—å£çš„èƒŒæ™¯è‰²ï¼Œä»… iOS æ”¯æŒ                                | å¾®ä¿¡å®¢æˆ·ç«¯ 6.5.16                                            |
| backgroundColorBottom                                        | string   | #ffffff  | åº•éƒ¨çª—å£çš„èƒŒæ™¯è‰²ï¼Œä»… iOS æ”¯æŒ                                | å¾®ä¿¡å®¢æˆ·ç«¯ 6.5.16                                            |
| enablePullDownRefresh                                        | boolean  | false    | æ˜¯å¦å¼€å¯å½“å‰é¡µé¢ä¸‹æ‹‰åˆ·æ–°ã€‚ è¯¦è§ [Page.onPullDownRefresh](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onpulldownrefresh) |                                                              |
| onReachBottomDistance                                        | number   | 50       | é¡µé¢ä¸Šæ‹‰è§¦åº•äº‹ä»¶è§¦å‘æ—¶è·é¡µé¢åº•éƒ¨è·ç¦»ï¼Œå•ä½ä¸ºpxã€‚ è¯¦è§ [Page.onReachBottom](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onreachbottom) |                                                              |
| pageOrientation                                              | string   | portrait | å±å¹•æ—‹è½¬è®¾ç½®ï¼Œæ”¯æŒ `auto` / `portrait` / `landscape` è¯¦è§ [å“åº”æ˜¾ç¤ºåŒºåŸŸå˜åŒ–](https://developers.weixin.qq.com/miniprogram/dev/framework/view/resizable.html) | [2.4.0](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) (auto) / [2.5.0](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) (landscape) |
| disableScroll                                                | boolean  | false    | è®¾ç½®ä¸º `true` åˆ™é¡µé¢æ•´ä½“ä¸èƒ½ä¸Šä¸‹æ»šåŠ¨ã€‚ åªåœ¨é¡µé¢é…ç½®ä¸­æœ‰æ•ˆï¼Œæ— æ³•åœ¨ `app.json` ä¸­è®¾ç½® |                                                              |
| usingComponents                                              | Object   | å¦       | é¡µé¢[è‡ªå®šä¹‰ç»„ä»¶](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/)é…ç½® | [1.6.3](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
| initialRenderingCache                                        | string   |          | é¡µé¢[åˆå§‹æ¸²æŸ“ç¼“å­˜](https://developers.weixin.qq.com/miniprogram/dev/framework/view/initial-rendering-cache.html)é…ç½® | [2.11.1](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
| style                                                        | string   | default  | å¯ç”¨æ–°ç‰ˆçš„ç»„ä»¶æ ·å¼                                           | [2.10.2](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
| [singlePage](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html#singlePage) | Object   | å¦       | å•é¡µæ¨¡å¼ç›¸å…³é…ç½®                                             | [2.12.0](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |

>  é¡µé¢é…ç½®ä¸­åªèƒ½è®¾ç½® `app.json` ä¸­ `window` å¯¹åº”çš„é…ç½®é¡¹ï¼Œä»¥å†³å®šæœ¬é¡µé¢çš„çª—å£è¡¨ç°ï¼Œæ‰€ä»¥æ— éœ€å†™ `window` è¿™ä¸ªå±æ€§

#### è¿è¡Œç¯å¢ƒ

* å°ç¨‹åºçš„è¿è¡Œç¯å¢ƒåˆ†æˆæ¸²æŸ“å±‚å’Œé€»è¾‘å±‚ï¼Œå…¶ä¸­ï¼š
  *  WXML æ¨¡æ¿å’Œ WXSS æ ·å¼å·¥ä½œåœ¨æ¸²æŸ“å±‚ï¼Œ
  *  JS è„šæœ¬å·¥ä½œåœ¨é€»è¾‘å±‚ã€‚
* å°ç¨‹åºçš„æ¸²æŸ“å±‚å’Œé€»è¾‘å±‚åˆ†åˆ«ç”±2ä¸ªçº¿ç¨‹ç®¡ç†ï¼š
  * æ¸²æŸ“å±‚çš„ç•Œé¢ä½¿ç”¨äº†WebView è¿›è¡Œæ¸²æŸ“ï¼›
  * é€»è¾‘å±‚é‡‡ç”¨JsCoreçº¿ç¨‹è¿è¡ŒJSè„šæœ¬ã€‚
* ä¸€ä¸ªå°ç¨‹åºå­˜åœ¨å¤šä¸ªç•Œé¢ï¼Œæ‰€ä»¥æ¸²æŸ“å±‚å­˜åœ¨å¤šä¸ªWebViewçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹çš„é€šä¿¡ä¼šç»ç”±å¾®ä¿¡å®¢æˆ·ç«¯ï¼ˆä¸‹æ–‡ä¸­ä¹Ÿä¼šé‡‡ç”¨Nativeæ¥ä»£æŒ‡å¾®ä¿¡å®¢æˆ·ç«¯ï¼‰åšä¸­è½¬ï¼Œé€»è¾‘å±‚å‘é€ç½‘ç»œè¯·æ±‚ä¹Ÿç»ç”±Nativeè½¬å‘ï¼Œå°ç¨‹åºçš„é€šä¿¡æ¨¡å‹ä¸‹å›¾æ‰€ç¤º:

![](./æ€»img/æ¡†æ¶7\image-1573546892966.png)

##### ç¨‹åºä¸é¡µé¢

* å¾®ä¿¡å®¢æˆ·ç«¯åœ¨æ‰“å¼€å°ç¨‹åºä¹‹å‰ï¼Œä¼šæŠŠæ•´ä¸ªå°ç¨‹åºçš„ä»£ç åŒ…ä¸‹è½½åˆ°æœ¬åœ°ã€‚
* ç´§æ¥ç€é€šè¿‡ `app.json` çš„ `pages` å­—æ®µå°±å¯ä»¥çŸ¥é“ä½ å½“å‰å°ç¨‹åºçš„æ‰€æœ‰é¡µé¢è·¯å¾„ã€‚
  * å…¶ä¸­`pages` ä¸­çš„ç¬¬ä¸€ä¸ªé¡µé¢å°±æ˜¯è¿™ä¸ªå°ç¨‹åºçš„é¦–é¡µï¼ˆæ‰“å¼€å°ç¨‹åºçœ‹åˆ°çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼‰ã€‚
* äºæ˜¯å¾®ä¿¡å®¢æˆ·ç«¯å°±æŠŠé¦–é¡µçš„ä»£ç è£…è½½è¿›æ¥ï¼Œé€šè¿‡å°ç¨‹åºåº•å±‚çš„ä¸€äº›æœºåˆ¶ï¼Œå°±å¯ä»¥æ¸²æŸ“å‡ºè¿™ä¸ªé¦–é¡µã€‚
* å°ç¨‹åºå¯åŠ¨ä¹‹åï¼Œåœ¨ `app.js` å®šä¹‰çš„ `App` å®ä¾‹çš„ `onLaunch` å›è°ƒä¼šè¢«æ‰§è¡Œ:

```javascript
App({
  onLaunch: function () {
    // å°ç¨‹åºå¯åŠ¨ä¹‹å è§¦å‘
  }
})
```

* æ•´ä¸ªå°ç¨‹åºåªæœ‰ä¸€ä¸ª App å®ä¾‹ï¼Œæ˜¯å…¨éƒ¨é¡µé¢å…±äº«çš„ã€‚

##### å°ç¨‹åºç»„ä»¶

* å°ç¨‹åºæä¾›äº†ä¸°å¯Œçš„åŸºç¡€ç»„ä»¶ç»™å¼€å‘è€…ï¼Œå¼€å‘è€…å¯ä»¥åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œç»„åˆå„ç§ç»„ä»¶æ‹¼åˆæˆè‡ªå·±çš„å°ç¨‹åºã€‚
* åªéœ€è¦åœ¨ `WXML` å†™ä¸Šå¯¹åº”çš„ç»„ä»¶æ ‡ç­¾åå­—å°±å¯ä»¥æŠŠè¯¥ç»„ä»¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šï¼Œä¾‹å¦‚ï¼Œä½ éœ€è¦åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºåœ°å›¾ï¼Œä½ åªéœ€è¦è¿™æ ·å†™å³å¯ï¼š

```html
<map longitude="113.324520" latitude="23.099994" scale="14" show-location></map>
```

* å¯ä»¥é€šè¿‡å±æ€§ä¼ é€’å€¼ç»™ç»„ä»¶ï¼Œè®©ç»„ä»¶å¯ä»¥ä»¥ä¸åŒçš„çŠ¶æ€å»å±•ç°ï¼Œä¹Ÿä¼šé€šè¿‡äº‹ä»¶çš„å½¢å¼è®©å¼€å‘è€…å¯ä»¥æ„ŸçŸ¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `style` æˆ–è€… `class` æ¥æ§åˆ¶ç»„ä»¶çš„å¤–å±‚æ ·å¼ï¼Œä»¥ä¾¿é€‚åº”ä½ çš„ç•Œé¢å®½åº¦é«˜åº¦ç­‰ç­‰ã€‚

##### å°ç¨‹åºAPI

* ä¸ºäº†è®©å¼€å‘è€…å¯ä»¥å¾ˆæ–¹ä¾¿çš„è°ƒèµ·å¾®ä¿¡æä¾›çš„èƒ½åŠ›ï¼Œä¾‹å¦‚è·å–ç”¨æˆ·ä¿¡æ¯ã€å¾®ä¿¡æ”¯ä»˜ç­‰ç­‰ï¼Œå°ç¨‹åºæä¾›äº†å¾ˆå¤š API ç»™å¼€å‘è€…å»ä½¿ç”¨ã€‚
* ä¾‹å¦‚ï¼Œè¦è·å–ç”¨æˆ·çš„åœ°ç†ä½ç½®æ—¶ï¼Œåªéœ€è¦ï¼š

```javascript
//
wx.getLocation({
  type: 'wgs84',
  success: (res) => {
    var latitude = res.latitude // çº¬åº¦
    var longitude = res.longitude // ç»åº¦
  }
})

//----è¿˜éœ€è¦åœ¨app.jsonä¸­å¼€å¯å®šä½æˆæƒã€‚descï¼šå½“è·å–å®šä½æ—¶ï¼Œåœ¨å¼¹å‡ºæˆæƒæ¡†ä¸Šæ˜¾ç¤ºçš„å†…å®¹
"permission": {
    "scope.userLocation": {
        "desc": "ä½ çš„ä½ç½®ä¿¡æ¯å°†ç”¨äºå°ç¨‹åºä½ç½®æ¥å£çš„æ•ˆæœå±•ç¤º" 
    }
}
```

* ä¾‹å¦‚ï¼Œè°ƒç”¨å¾®ä¿¡æ‰«ä¸€æ‰«èƒ½åŠ›ï¼Œåªéœ€è¦ï¼š

```javascript
wx.scanCode({
  success: (res) => {
    console.log(res)
  }
})
```

* å¤šæ•° API çš„å›è°ƒéƒ½æ˜¯å¼‚æ­¥ï¼Œä½ éœ€è¦å¤„ç†å¥½ä»£ç é€»è¾‘çš„å¼‚æ­¥é—®é¢˜ã€‚
* æ›´å¤šçš„ API èƒ½åŠ›è§ [å°ç¨‹åºçš„API](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html)ã€‚

### å°ç»“



## é¢é¢å°ç¨‹åºä»‹ç»ä¸åˆå§‹åŒ–

### ç›®æ ‡

* åˆå§‹åŒ–é¢é¢å¾®ä¿¡å°ç¨‹åº
* æ„å»ºå¾®ä¿¡å°ç¨‹åº APIæ¨¡å—

### è®²è§£

#### åˆå§‹åŒ–é¢é¢å°ç¨‹åºã€æ“ä½œçš„ï¼Œè¦æŒæ¡ã€‘

* é¢é¢å°ç¨‹åºçš„å¼€å‘æ˜¯åœ¨å·²ç»æ„å»ºå¥½çš„å°ç¨‹åºå‰ç«¯å·¥ç¨‹åŸºç¡€ä¸Šæ¥å®Œæˆï¼Œæ— éœ€åç«¯å·¥ç¨‹å¸ˆå»æ„å»ºå¤æ‚çš„å°ç¨‹åºå‰ç«¯é¡µé¢ã€‚
* æŠŠã€Šèµ„æ–™/å‰ç«¯ä»£ç /project-mp-mianshi_å°ç¨‹åºä»£ç .zipã€‹è§£å‹ç¼©åˆ°æœ¬åœ°å·¥ç¨‹ç›®å½•ï¼Œå½“å‰ç»™çš„ä»£ç æ˜¯åŸºäºæ¨¡æ‹ŸAPIå®Œæˆäº†æ‰€æœ‰ä¸šåŠ¡è·¯å¾„çš„è°ƒç”¨ï¼Œæ•…å°ç¨‹åºè¢«å¯¼å…¥å¾®ä¿¡å°ç¨‹åºå·¥å…·åæ˜¯å®Œæˆå¼€ä¸šç‹¬ç«‹è¿è¡Œçš„ï¼Œæ‰€æœ‰çš„APIè°ƒç”¨éƒ½æ˜¯è°ƒç”¨çš„æ¨¡æ‹ŸAPIã€‚

##### 1. å¯¼å…¥å°ç¨‹åºé¡¹ç›®

###### è§£å‹å°ç¨‹åºå‹ç¼©åŒ…

* è§£å‹åˆ°ä¸å«ä¸­æ–‡ã€ç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦çš„ç›®å½•ï¼Œæ¯”å¦‚ï¼šæˆ‘çš„è§£å‹åˆ°äº†`C:\programs\wechatProjects`ç›®å½•ä¸‹

![image-20200309104303687](./æ€»img/æ¡†æ¶7/image-20200309104303687.png)

![image-20200309104419087](./æ€»img/æ¡†æ¶7/image-20200309104419087.png)

###### æŠŠå°ç¨‹åºå¯¼å…¥å¼€å‘è€…å·¥å…·

* è¯´æ˜ï¼š
  * å¦‚æœè¦é¢„è§ˆæ•ˆæœï¼Œå¯¼å…¥ã€Šproject-mp-mianshi-é¢„è§ˆæ•ˆæœçš„.zipã€‹
  * æˆ‘ä»¬è‡ªå·±å¼€å‘ä½¿ç”¨ï¼Œå¯¼å…¥ã€Šproject-mp-mianshi-æˆ‘ä»¬å¼€å‘ç”¨çš„.rarã€‹

* æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œç‚¹å‡»+å·

![image-20200309104533249](./æ€»img/æ¡†æ¶7/image-20200309104533249.png)

* é€‰æ‹©â€œå¯¼å…¥é¡¹ç›®â€ï¼Œé€‰ä¸­è§£å‹ç›®å½•ï¼Œè¾“å…¥è‡ªå·±çš„AppID

![image-20200309104652019](./æ€»img/æ¡†æ¶7/image-20200309104652019.png)

##### 2. è®¾ç½®é¡¹ç›®

###### è®¾ç½®æœåŠ¡ç«¯åœ°å€

* æ‰“å¼€`utils/config.js`ï¼Œè®¾ç½®ä½¿ç”¨ç¬¬äºŒä¸ª`urlBase`çš„åœ°å€å€¼
* è¿™ä¸ªåœ°å€ï¼Œå¯ä»¥ä¾›æˆ‘ä»¬é¢„è§ˆæŸ¥çœ‹é¢é¢å°ç¨‹åºçš„æ•ˆæœ
* åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¦æŠŠè¿™ä¸ªåœ°å€æ”¹æˆ  ä½ è‡ªå·±Tomcatéƒ¨ç½²çš„åœ°å€

![image-20200309110408183](./æ€»img/æ¡†æ¶7/image-20200309110408183.png)

###### æœ¬åœ°æ£€æŸ¥é¡¹è®¾ç½®

![image-20200309105046201](./æ€»img/æ¡†æ¶7/image-20200309105046201.png)

###### ç¼“å­˜è®¾ç½®

* ç¼“å­˜ä¸æ˜¯å¿…é¡»çš„ï¼Œä¸€èˆ¬ç¬¬1æ¬¡ç™»å½•æˆ–ä¿å­˜è¿‡æ•°æ®åï¼Œåç»­æ ¹æ®æƒ…å†µå¯ä»¥æ¸…é™¤ç¼“å­˜ï¼Œä¾¿äºè°ƒè¯•ã€‚å¯ä»¥å¦‚å›¾æ“ä½œï¼š

![image-20200309105212581](./æ€»img/æ¡†æ¶7/image-20200309105212581.png)

###### ç¼–è¯‘è¿è¡Œ

* ç”±äºåŸå‹å·²é›†æˆäº†GPSå®šä½ï¼Œåˆšæ‰æ¸…é™¤å…¨éƒ¨çŠ¶æ€åï¼Œç‚¹å‡»â€œç¼–è¯‘â€ï¼Œä¼šå¦‚å›¾æç¤ºæˆæƒå®šä½ï¼ˆä¸‹æ¬¡ä¸å†æç¤ºï¼‰ï¼š

![image-20200309105352101](./æ€»img/æ¡†æ¶7/image-20200309105352101.png)

* ç‚¹å‡»â€œç¡®å®šâ€åï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![image-20200309105502353](./æ€»img/æ¡†æ¶7/image-20200309105502353.png)

* åœ¨ä¸Šå›¾ä¸­é€‰æ‹©åœ°åŒºã€é€‰æ‹©å­¦ç§‘ï¼Œç„¶åç‚¹å‡»â€œç¡®å®šâ€ã€‚ä¼šå¼¹å‡º å¾®ä¿¡ç™»å½•æˆæƒæç¤ºï¼Œå…è®¸åè¿›å…¥ä¸»é¡µ

![image-20200309105834775](./æ€»img/æ¡†æ¶7/image-20200309105834775.png)

#### æ„å»ºå°ç¨‹åºçš„æœåŠ¡ç«¯

##### æ­¥éª¤

1. åœ¨ideaé‡Œåˆ›å»ºMavençš„webå·¥ç¨‹
2. åœ¨pom.xmlé‡Œæ·»åŠ åæ ‡
3. æ‹·è´å®ä½“ç±»ã€å¸¸é‡
4. æ‹·è´é…ç½®æ–‡ä»¶
5. é…ç½®web.xml

##### å®ç°

###### 1. åœ¨ideaé‡Œåˆ›å»ºMavençš„webå·¥ç¨‹

* åˆ›å»ºMavençš„webå·¥ç¨‹ï¼Œè®¾ç½®åæ ‡
* è¡¥å…¨ç›®å½•ï¼š`java`å’Œ`resources`

###### 2. åœ¨pom.xmlé‡Œæ·»åŠ åæ ‡

```xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.itheima</groupId>
    <artifactId>mm_wx_api</artifactId>
    <version>1.0-SNAPSHOT</version>
    <packaging>war</packaging>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
        <junit.version>4.12</junit.version>
        <javax.servlet-api.version>3.1.0</javax.servlet-api.version>
        <fastjson.version>1.2.47</fastjson.version>
        <mysql-connector-java.version>5.1.38</mysql-connector-java.version>
        <mybatis.version>3.4.5</mybatis.version>
        <log4j.version>1.2.17</log4j.version>
        <slf4j-api.version>1.7.25</slf4j-api.version>
        <commons-fileupload.version>1.3.1</commons-fileupload.version>
        <commons-io.version>2.6</commons-io.version>
        <lombok.version>1.18.8</lombok.version>
        <tomcat7-maven-plugin.version>2.2</tomcat7-maven-plugin.version>
        <dom4j.version>1.6.1</dom4j.version>
        <jaxen.version>1.2.0</jaxen.version>
        <druid.version>1.1.10</druid.version>
        <okhttp.version>3.1.0</okhttp.version>
        <okio.version>1.4.0</okio.version>
        <bcprov-jdk16.version>1.45</bcprov-jdk16.version>
        <jedis.version>2.7.0</jedis.version>
        <jackson.version>2.3.3</jackson.version>
    </properties>
    <dependencies>
        <!--è‡ªå®šä¹‰MVC-->
        <dependency>
            <groupId>com.itheima</groupId>
            <artifactId>mm_mvc</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <!--å•å…ƒæµ‹è¯•-->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>${junit.version}</version>
        </dependency>
        <!--Servlet-->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>${javax.servlet-api.version}</version>
            <scope>provided</scope>
        </dependency>

        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>fastjson</artifactId>
            <version>${fastjson.version}</version>
        </dependency>
        <!--jackson-->
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
            <version>${jackson.version}</version>
        </dependency>
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-core</artifactId>
            <version>${jackson.version}</version>
        </dependency>
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-annotations</artifactId>
            <version>${jackson.version}</version>
        </dependency>
        <!--mysqlé©±åŠ¨-->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>${mysql-connector-java.version}</version>
        </dependency>
        <!--mybatis-->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>${mybatis.version}</version>
        </dependency>
        <!--beanutils-->
        <dependency>
            <groupId>commons-beanutils</groupId>
            <artifactId>commons-beanutils</artifactId>
            <version>1.9.3</version>
        </dependency>
        <!--æ–‡ä»¶ä¸Šä¼ -->
        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
            <version>${commons-fileupload.version}</version>
        </dependency>
        <!--IO-->
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
            <version>${commons-io.version}</version>
        </dependency>
        <!--dom4j-->
        <dependency>
            <groupId>dom4j</groupId>
            <artifactId>dom4j</artifactId>
            <version>${dom4j.version}</version>
        </dependency>
        <dependency>
            <groupId>jaxen</groupId>
            <artifactId>jaxen</artifactId>
            <version>${jaxen.version}</version>
        </dependency>
        <!--æ—¥å¿—-->
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>${log4j.version}</version>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <version>${slf4j-api.version}</version>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-log4j12</artifactId>
            <version>${slf4j-api.version}</version>
        </dependency>
        <!--lombok-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>${lombok.version}</version>
        </dependency>
        <!--è¿æ¥æ± -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>${druid.version}</version>
        </dependency>
        <!--okhttp-->
        <dependency>
            <groupId>com.squareup.okhttp3</groupId>
            <artifactId>okhttp</artifactId>
            <version>${okhttp.version}</version>
        </dependency>
        <dependency>
            <groupId>com.squareup.okio</groupId>
            <artifactId>okio</artifactId>
            <version>${okio.version}</version>
        </dependency>
        <dependency>
            <groupId>org.bouncycastle</groupId>
            <artifactId>bcprov-jdk16</artifactId>
            <version>${bcprov-jdk16.version}</version>
        </dependency>
        <!--jedis-->
        <dependency>
            <groupId>redis.clients</groupId>
            <artifactId>jedis</artifactId>
            <version>${jedis.version}</version>
        </dependency>
    </dependencies>

    <build>
        <resources>
            <resource>
                <directory>src/main/java</directory>
                <includes>
                    <include>**/*.xml</include>
                    <include>**/*.properties</include>
                </includes>
                <filtering>false</filtering>
            </resource>
            <resource>
                <directory>src/main/resources</directory>
                <includes>
                    <include>**/*.xml</include>
                    <include>**/*.properties</include>
                </includes>
                <filtering>false</filtering>
            </resource>
        </resources>
    </build>
</project>
```

###### 3. æ‹·è´å®ä½“ç±»å’Œå¸¸é‡

* åœ¨`java`é‡Œåˆ›å»ºpackageï¼š`com.itheima.mm`
* æŠŠã€Šèµ„æ–™\06-åˆå§‹åŒ–å·¥ç¨‹\01-ä»£ç (å®ä½“ç±», å¸¸é‡ç­‰)ã€‹ï¼Œæ‹·è´æ”¾åˆ°`com.itheima.mm`ä¸­
* åœ¨`com.itheima.mm`é‡Œåˆ›å»ºï¼š`controller`, `service`, `dao`ä¸‰ä¸ªåŒ…

###### 4. æ‹·è´é…ç½®æ–‡ä»¶

* æŠŠã€Šèµ„æ–™\06-åˆå§‹åŒ–å·¥ç¨‹\02-é…ç½®æ–‡ä»¶ã€‹é‡Œçš„é…ç½®ä¿¡æ¯ï¼Œæ‹·è´æ”¾åˆ°`resources`ç›®å½•é‡Œ
* æ³¨æ„ï¼š`db.properties`ä¸­ï¼Œæ•°æ®åº“åœ°å€è¦é…ç½®æ­£ç¡®

###### 5. é…ç½®`web.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
         id="WebApp_ID" version="2.5">

    <servlet>
        <servlet-name>DispacherServlet</servlet-name>
        <servlet-class>com.itheima.mm.framework.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>packageScan</param-name>
            <param-value>com.itheima.mm.controller</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    <servlet-mapping>
        <servlet-name>DispacherServlet</servlet-name>
        <url-pattern>*.do</url-pattern>
    </servlet-mapping>
    <filter>
        <filter-name>CharchaterFilter</filter-name>
        <filter-class>com.itheima.mm.filter.CharchaterFilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>CharchaterFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
</web-app>
```

###### 6. æœ€ç»ˆçš„ç›®å½•ç»“æ„

![image-20200309111903239](./æ€»img/æ¡†æ¶7/image-20200309111903239.png)

###### 7. éƒ¨ç½²åˆ°Tomcatå¹¶å¯åŠ¨

* æŠŠ`mm_wx_api`éƒ¨ç½²åˆ°Tomcatå¹¶å¯åŠ¨æœåŠ¡ã€‚è®¿é—®åœ°å€æ˜¯ï¼š`http://localhost:808/wxapi`

![image-20200309112432465](./æ€»img/æ¡†æ¶7/image-20200309112432465.png)

* æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œä¿®æ”¹é¢é¢å°ç¨‹åºçš„æœåŠ¡åœ°å€
  * æ³¨æ„ï¼šå› ä¸ºæˆ‘ä»¬çš„æœåŠ¡ç«¯è¿˜æ²¡æœ‰å†™ä»»ä½•åŠŸèƒ½ï¼Œæ‰€ä»¥å°ç¨‹åºä¼šæŠ¥é”™ï¼Œæ˜¯æ­£å¸¸çš„

![image-20200309112629703](./æ€»img/æ¡†æ¶7/image-20200309112629703.png)

###### 8. ä¿®æ”¹é¢é¢å°ç¨‹åºçš„è¯·æ±‚åœ°å€

![image-20200310113908202](./æ€»img/æ¡†æ¶7/image-20200310113908202.png)

### å°ç»“

## é¢é¢å°ç¨‹åºçš„ä¸šåŠ¡åŠŸèƒ½

### åŸå¸‚å®šä½-è·å–åœ°åŒºæ•°æ®

#### ç›®æ ‡

é¢é¢å°ç¨‹åºç«¯ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œè¦ï¼š

* å¾®ä¿¡å°ç¨‹åºå…ˆå®šä½ä½¿ç”¨è€…å½“å‰çš„ä½ç½®ï¼Œæ˜¯GPSå®šä½æ•°æ®ï¼Œæ˜¯åæ ‡ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰
* ç„¶åæ ¹æ®å¾®ä¿¡æä¾›çš„åœ°ç†ä½ç½®ä¿¡æ¯ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰ï¼Œä½¿ç”¨é«˜å¾·åœ°å›¾æœåŠ¡ï¼ŒæŠŠåæ ‡è½¬æ¢æˆåŸå¸‚åç§°
  * æ ¹æ®åŸå¸‚åç§°ï¼ŒåŠ è½½åˆ°åŸå¸‚çš„Dictæ•°æ®ï¼Œä»¥åŠæ‰€æœ‰åŸå¸‚åˆ—è¡¨ã€‚
* å¦‚æœåŸå¸‚ä¸æ˜¯å½“å‰ç”¨æˆ·éœ€è¦çš„ï¼Œå¯ä»¥è¿›å…¥åŸå¸‚åˆ—è¡¨ï¼Œå¯»æ‰¾æ„å‘çš„åŸå¸‚åç§°ã€‚

![image-20200310135123260](./æ€»img/æ¡†æ¶7/image-20200310135123260.png)![image-20200309172853093](./æ€»img/æ¡†æ¶7/image-20200309172853093.png) 

#### åˆ†æ

##### æ‰§è¡Œæµç¨‹

åˆ†æå›¾1

![image-20200309164211277](./æ€»img/æ¡†æ¶7/image-20200309164211277.png)

åˆ†æå›¾2	

![02.åŠ è½½åŸå¸‚](D:\Javaç¬”è®°_Typora\æˆ‘æ·»åŠ çš„img\02.åŠ è½½åŸå¸‚.png)

##### æ•°æ®æ¨¡å‹

###### è¯·æ±‚å‚æ•°

* fsï¼šè¦åŠ è½½çš„åŸå¸‚æ•°æ®æ ‡ç­¾ï¼Œå¯¹åº”`t_dict`è¡¨é‡Œçš„`data_tag`å­—æ®µ
  * 0ï¼šä¸é¦–é¡µæ˜¾ç¤º 
  * 1ï¼šé¦–é¡µæ˜¾ç¤º
* locationï¼šå°ç¨‹åºçš„GPSå®šä½ï¼Œæ˜¯ç»çº¬å€¼

```json
{
    "fs": 1,
    "location": "113.6401,34.72468"
}
```

###### å“åº”ç»“æœ

* locationï¼šå°ç¨‹åºGPSå®šä½ç‚¹ç»çº¬åº¦ï¼Œå¯¹åº”çš„åœ°åŒºåŸå¸‚
  * idï¼šåœ°åŒºçš„id
  * titleï¼šåœ°åŒºçš„åç§°
* citysï¼šæ ¹æ®å‚æ•°åŠ è½½çš„åœ°åŒºåˆ—è¡¨ã€‚å¸‚ä¸€çº§çš„åŸå¸‚
  * idï¼šåœ°åŒºçš„id
  * titleï¼šåœ°åŒºçš„åç§°

```json
{
    "location": {
        "id": 19,
        "title": "éƒ‘å·"
    },
    "citys": [
        {
            "id": 9,
            "title": "åŒ—äº¬"
        },
        {
            "id": 10,
            "title": "ä¸Šæµ·"
        }
    ]    
}
```

#### å®ç°

##### ä¿®æ”¹å°ç¨‹åºå‘è¯·æ±‚çš„åœ°å€

![image-20200309121922953](./æ€»img/æ¡†æ¶7/image-20200309121922953.png)

##### `CommonController`

* åˆ›å»º`CommonController`ç±»ï¼Œå¹¶åˆ›å»ºæ–¹æ³•

```java
    /**
     * @author liuyp
     * @date 2020/03/09
     */
    @Controller
    public class CommonController {
        private CommonService commonService = new CommonService();

        @RequestMapping("/common/cities")
        public void loadCities(HttpServletRequest request, HttpServletResponse response) throws IOException {
            try {
                HashMap map = JsonUtils.parseJSON2Object(request, HashMap.class);
                Map resultMap = commonService.loadCities(map);
                JsonUtils.printResult(response, resultMap);
            } catch (Exception e) {
                e.printStackTrace();
                JsonUtils.printResult(response, null);
            }
        }
    }
```

##### `CommonService`

* åˆ›å»º`CommonService`ç±»ï¼Œå¹¶åˆ›å»ºæ–¹æ³•

```java
/**
 * @author liuyp
 * @date 2020/03/09
 */
public class CommonService {
    public Map loadCities(HashMap map) throws IOException {
        SqlSession session = SqlSessionFactoryUtils.openSqlSession();
        DictDao dictDao = session.getMapper(DictDao.class);

        //æ ¹æ®å°ç¨‹åºä¼ é€’è¿‡æ¥çš„locationï¼ˆå®šä½çš„ç»çº¬åº¦ï¼‰ï¼Œå¾—åˆ°å¯¹åº”çš„åŸå¸‚å
        String cityName = LocationUtil.parseLocation((String) map.get("location"));

        //ä»æ•°æ®åº“ä¸­ï¼Œæ ¹æ®åŸå¸‚åç§°ï¼ŒæŸ¥è¯¢åŸå¸‚æ•°æ®Dictå¯¹è±¡
        Dict dict = dictDao.findByCityName(cityName);

        //åŠ è½½åŸå¸‚åˆ—è¡¨ï¼Œä¾›å°ç¨‹åºé€‰æ‹©å…¶å®ƒåŸå¸‚
        List<Dict> dictList = dictDao.findByTag((Integer) map.get("fs"));

        Map<String, Object> resultMap = new HashMap<>();
        resultMap.put("location", dict);
        resultMap.put("citys", dictList);

        SqlSessionFactoryUtils.commitAndClose(session);
        return resultMap;
    }
}
```

##### `DictDao`

###### æ˜ å°„å™¨`DictDao`æ¥å£ï¼Œå¹¶åˆ›å»ºæ–¹æ³•

```java
/**
 * @author liuyp
 * @date 2020/03/09
 */
public interface DictDao {
    Dict findByCityName(String cityName);

    List<Dict> findByTag(Integer dataTag);
}
```

###### æ˜ å°„æ–‡ä»¶`DictDao.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.mm.dao.DictDao">
    <select id="findByCityName" parameterType="string" resultType="Dict">
        select id, data_value title from t_dict where data_value like "%"#{cityName}"%"
    </select>

    <select id="findByTag" parameterType="int" resultType="Dict">
        select id, data_value title from t_dict where data_type = 1 and data_tag = #{dataTag}
    </select>
</mapper>
```

#### å°ç»“

æ³¨æ„:è¦å°†LocationUtilå·¥å…·ç±»ä¸­çš„amap_api_keyå€¼æ”¹ä¸ºè‡ªå·±åœ¨é«˜å¾·åœ°å›¾ä¸Šåˆ›å»ºçš„key

å·¥å…·ç±»ä¸­è¦æ”¹çš„keyä½ç½®	

![image-20201024215400157](D:\Javaç¬”è®°_Typora\æˆ‘æ·»åŠ çš„img\image-20201024215400157.png)

é«˜å¾·åœ°å›¾ä¸Šçš„key

![image-20201024215454767](D:\Javaç¬”è®°_Typora\æˆ‘æ·»åŠ çš„img\image-20201024215454767.png)

#### æ‹“å±•ï¼šæ³¨å†Œå’Œä½¿ç”¨é«˜å¾·åœ°å›¾å¹³å°

##### æ³¨å†Œæˆä¸ºé«˜å¾·å¹³å°ç”¨æˆ·

* ä½¿ç”¨é«˜å¾·åœ°å›¾APIï¼Œå…ˆè¿›å…¥å®˜æ–¹<https://lbs.amap.com/>æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œå¦‚å›¾

![image-20200309222529014](./æ€»img/æ¡†æ¶7/image-20200309222529014.png)

* åˆ›å»ºkey

![image-20200309222705467](./æ€»img/æ¡†æ¶7/image-20200309222705467.png)

* æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªkey

![image-20200309222751255](./æ€»img/æ¡†æ¶7/image-20200309222751255.png)

##### é«˜å¾·çš„åœ°å€è§£æAPI

* å‚è€ƒé«˜å¾·åœ°å›¾API https://lbs.amap.com/api/webservice/guide/api/georegeo é€†åœ°å€è§£æï¼Œæ¥å®Œæˆä¸€ä¸ªåœ°ç†ä½ç½®ä¿¡æ¯çš„è§£æå·¥å…·ã€‚

![image-20200309222940342](./æ€»img/æ¡†æ¶7/image-20200309222940342.png)

* æœåŠ¡ç¤ºä¾‹ï¼š

```
https://restapi.amap.com/v3/geocode/regeo?output=json&location=116.310003,39.991957&key=<ç”¨æˆ·çš„key>

https://restapi.amap.com/v3/geocode/regeo?output=json&location=116.310003,39.991957&key=8b9d9fbf5c8f2474b91838a7545fb45b
```

* å¾—åˆ°ç»“æœ

```java
{
    "info": "OK",
    "infocode": "10000",
    "regeocode": {
        "addressComponent": {
            "adcode": "110108",
            "building": {
                "name": "åŒ—äº¬å¤§å­¦",
                "type": "ç§‘æ•™æ–‡åŒ–æœåŠ¡;å­¦æ ¡;é«˜ç­‰é™¢æ ¡"
            },
            "businessAreas": [
                {
                    "id": "110108",
                    "location": "116.303364,39.97641",
                    "name": "ä¸‡æ³‰æ²³"
                },
                {
                    "id": "110108",
                    "location": "116.314222,39.98249",
                    "name": "ä¸­å…³æ‘"
                },
                {
                    "id": "110108",
                    "location": "116.294214,39.99685",
                    "name": "è¥¿è‹‘"
                }
            ],
            "city": [],
            "citycode": "010",
            "country": "ä¸­å›½",
            "district": "æµ·æ·€åŒº",
            "neighborhood": {
                "name": "åŒ—äº¬å¤§å­¦",
                "type": "ç§‘æ•™æ–‡åŒ–æœåŠ¡;å­¦æ ¡;é«˜ç­‰é™¢æ ¡"
            },
            "province": "åŒ—äº¬å¸‚",
            "streetNumber": {
                "direction": "ä¸œåŒ—",
                "distance": "94.5489",
                "location": "116.310454,39.9927339",
                "number": "5å·",
                "street": "é¢å’Œå›­è·¯"
            },
            "towncode": "110108015000",
            "township": "ç‡•å›­è¡—é“"
        },
        "formatted_address": "åŒ—äº¬å¸‚æµ·æ·€åŒºç‡•å›­è¡—é“åŒ—äº¬å¤§å­¦"
    },
    "status": "1"
}
```



### è·å–å­¦ç§‘åˆ—è¡¨

#### ç›®æ ‡

* åœ¨è¿™ä¸ªé¡µé¢è¿˜éœ€è¦è·å–å­¦ç§‘åˆ—è¡¨ï¼Œä¾›å°ç¨‹åºä½¿ç”¨è€…é€‰æ‹©è¦åˆ·å“ªä¸ªå­¦ç§‘çš„é¢è¯•é¢˜

![image-20200309173011247](./æ€»img/æ¡†æ¶7/image-20200309173011247.png)

#### åˆ†æ

##### æ‰§è¡Œæµç¨‹

![03.åŠ è½½å­¦ç§‘](D:\Javaç¬”è®°_Typora\æˆ‘æ·»åŠ çš„img\03.åŠ è½½å­¦ç§‘.png)

##### æ•°æ®æ¨¡å‹

###### è¯·æ±‚å‚æ•°

* æ— ã€‚æŸ¥è¯¢æ‰€æœ‰å­¦ç§‘

###### å“åº”ç»“æœ

```json
[
    {
        "icon": "",
        "id": 1,
        "title": "Java"
    },
    {
        "icon": "",
        "id": 2,
        "title": "Python"
    }
]
```

#### å®ç°

###### ä¿®æ”¹å°ç¨‹åºå‘è¯·æ±‚çš„åœ°å€

![image-20200309151308824](./æ€»img/æ¡†æ¶7/image-20200309151308824.png)

###### `CommonController`

* åœ¨`CommonController`é‡Œå¢åŠ æ–¹æ³•

```java
    @RequestMapping("/common/courses")
    public void loadCourses(HttpServletRequest request, HttpServletResponse response) throws IOException {
        try {
            List<Course> courseList = commonService.loadCourses();
            JsonUtils.printResult(response, courseList);
        } catch (Exception e) {
            e.printStackTrace();
            JsonUtils.printResult(response, null);
        }
    }
```

###### `CommonService`

* åœ¨`CommonService`ç±»é‡Œå¢åŠ æ–¹æ³•

```java
    public List<Course> loadCourses() throws IOException {
        SqlSession session = SqlSessionFactoryUtils.openSqlSession();
        CourseDao dao = session.getMapper(CourseDao.class);

        List<Course> courseList = dao.queryAll();
        SqlSessionFactoryUtils.commitAndClose(session);
        return courseList;
    }
```

###### `CourseDao`

* åˆ›å»ºæ˜ å°„å™¨`CourseDao`

```java
/**
 * @author liuyp
 * @date 2020/03/09
 */
public interface CourseDao {
    List<Course> queryAll();
}

```

* åˆ›å»ºæ˜ å°„æ–‡ä»¶`CourseDao.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.mm.dao.CourseDao">
    <select id="queryAll" resultType="Course">
        select id,name title, icon from t_course
    </select>
</mapper>
```

#### å°ç»“

### ä¼˜åŒ–å­¦ç§‘åˆ—è¡¨

#### ç›®æ ‡

* ä½¿ç”¨redisä¼˜åŒ–å­¦ç§‘åˆ—è¡¨åŠŸèƒ½

#### åˆ†æ

* å­¦ç§‘åˆ—è¡¨ç»å¸¸è·å–ï¼Œä¸”ä¸ç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥å€ŸåŠ©redisæ¥ä¼˜åŒ–å­¦ç§‘åˆ—è¡¨çš„è·å–é€Ÿåº¦ã€‚
* åœ¨ç¬¬ä¸€æ¬¡è·å–å­¦ç§‘åˆ—è¡¨æ—¶ï¼Œåˆ¤æ–­redisä¸­æ˜¯å¦æœ‰ç¼“å­˜æ•°æ®ï¼š
  * å¦‚æœæ²¡æœ‰ç¼“å­˜æ•°æ®ï¼Œéœ€è¦å…ˆä»æ•°æ®åº“è·å–å­¦ç§‘åˆ—è¡¨ï¼Œç„¶åè½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²åå­˜å…¥redisã€‚
  * å¦‚æœredisä¸­æœ‰å­¦ç§‘ç¼“å­˜æ•°æ®ï¼Œéœ€è¦æŠŠjsonå­—ç¬¦ä¸²è½¬åŒ–ä¸ºJSONå¯¹è±¡ç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚
  * å¼€å¯windowçš„redisæœåŠ¡å™¨
  * ![image-20201024213911450](D:\Javaç¬”è®°_Typora\æˆ‘æ·»åŠ çš„img\image-20201024213911450.png)

#### å®ç°

##### ä¿®æ”¹`CommonController`

```java
    @RequestMapping("/common/courses")
    public void loadCourses(HttpServletRequest request, HttpServletResponse response) throws IOException {
        try {
            String courses = commonService.loadCourses();
            JsonUtils.printResult(response, JSON.parse(courses));
        } catch (Exception e) {
            e.printStackTrace();
            JsonUtils.printResult(response, null);
        }
    }
```

##### ä¿®æ”¹`CommonService`

```java
    public String loadCourses() throws IOException {
        List<Course> courseList = null;
		
        //ä¼˜å…ˆä»redisä¸­è·å–ç¼“å­˜
        Jedis jedis = JedisUtils.getJedis();
        String coursesJsonStr = jedis.get("coursesJsonStr");

        //å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œä»MySqlé‡ŒæŸ¥è¯¢
        if (coursesJsonStr == null){
            SqlSession session = SqlSessionFactoryUtils.openSqlSession();
            CourseDao dao = session.getMapper(CourseDao.class);
            courseList = dao.queryAll();
            SqlSessionFactoryUtils.commitAndClose(session);

            coursesJsonStr = JSON.toJSONString(courseList);
            jedis.set("coursesJsonStr", coursesJsonStr);
        }
        jedis.close();
        return coursesJsonStr;
    }
```

#### å°ç»“

```
ä¸‹åˆ’çº¿å­—æ®µåï¼Œè‡ªåŠ¨æ˜ å°„ é©¼å³°å¼å±æ€§å
```

![image-20201024215854444](D:\Javaç¬”è®°_Typora\æˆ‘æ·»åŠ çš„img\image-20201024215854444.png)

### ä¿å­˜å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯ï¼ˆç™»å½•ä¸æ³¨å†Œï¼‰

#### ç›®æ ‡

* å½“ç”¨æˆ·å®šä½äº†åŸå¸‚ã€é€‰æ‹©äº†å­¦ç§‘åï¼Œéœ€è¦ç‚¹å‡»ç¡®å®šæŒ‰é’®ï¼ŒæŠŠé€‰æ‹©çš„åŸå¸‚å’Œå­¦ç§‘ä¿å­˜åˆ°æœåŠ¡ç«¯ã€‚
* ä½†æ˜¯å‰ææ¡ä»¶æ˜¯ï¼šè¿™äº›ä¿¡æ¯å¿…é¡»è¦å’Œç”¨æˆ·ä¿¡æ¯å…³è”ã€‚
* å¦‚æœç”¨æˆ·æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªå°ç¨‹åºï¼ˆæˆ–è€…æ¸…é™¤äº†ç¼“å­˜ï¼‰ï¼Œä¼šå¼¹çª—è¦æ±‚å¾®ä¿¡æˆæƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
  * ä»å¾®ä¿¡å¹³å°ï¼Œå¾—åˆ°å¾®ä¿¡å¸å·çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šå¾®ä¿¡æ˜µç§°ã€å¤´åƒå›¾æ ‡é“¾æ¥ã€åœ°åŒºã€æ€§åˆ«ç­‰ç­‰ï¼ˆåŠ å¯†çš„ï¼‰
* å½“ç”¨æˆ·ç‚¹å‡»äº†â€œå…è®¸â€åï¼šå°ç¨‹åºä¼šæŠŠå¾®ä¿¡ç”¨æˆ·ä¿¡æ¯ï¼ˆåŠ å¯†çš„ï¼‰å‘é€åˆ°æˆ‘ä»¬æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è§£å¯†å¾—åˆ°å¾®ä¿¡ç”¨æˆ·çš„ä¿¡æ¯
* è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºç™»å½•å’Œæ³¨å†Œ
  * å¦‚æœç”¨æˆ·ç¬¬ä¸€æ¬¡ç”¨ï¼šæˆ‘ä»¬æŠŠå¾®ä¿¡å¸å·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œç›¸å½“äºæ³¨å†Œäº†
  * å¦‚æœç”¨æˆ·ä¸æ˜¯ç¬¬ä¸€æ¬¡ç”¨ï¼šæˆ‘ä»¬å°±ä»æ•°æ®åº“ä¸­åŠ è½½è¿™ä¸ªç”¨æˆ·çš„æ•°æ®ï¼Œç›¸å½“äºç™»å½•äº†

![image-20200309164937398](./æ€»img/æ¡†æ¶7/image-20200309164937398-1601206121973.png)

#### åˆ†æ

##### å°ç¨‹åºå®˜æ–¹éªŒè¯æµç¨‹å›¾

* å®˜æ–¹å°ç¨‹åºç™»å½•æµç¨‹å›¾ï¼š https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html 

![img](./æ€»img/æ¡†æ¶7/api-login.2fcc9f35-1601206121974.jpg)

##### å¾®ä¿¡å°ç¨‹åºéªŒè¯æµç¨‹

![image-20200310075723643](./æ€»img/æ¡†æ¶7/image-20200310075723643.png)

![04.æ³¨å†Œä¸ç™»å½•](D:\Javaç¬”è®°_Typora\æˆ‘æ·»åŠ çš„img\04.æ³¨å†Œä¸ç™»å½•.png)

##### æ•°æ®æ¨¡å‹

###### è¯·æ±‚å‚æ•°

* codeï¼šä¸´æ—¶ç™»å½•å‡­è¯
* encryptedDataï¼šåŠ å¯†åçš„å¾®ä¿¡å¸å·æ•°æ®
* ivï¼šè§£å¯†æ•°æ®éœ€è¦çš„åç§»é‡

```json
{
    "code": "011bskvF1mwK160vUdwF1w3ivF1bskvI",
    "encryptedData": "iSHBzhtPT7YBZrW3wSwHiD1jSsAr31A4gsoIVY5Z0HYqj0k49e/uEalOJSzOcgAFpjLN9wdfD6tA8jpioG52wP5xTEfaHGM1FG4WnsdCTd9Y1303h/uCqiMx+caN0eXeUdZdWegw8dDxE+mYAmEXgvvzzBrGFwYjYmw1mdTKDyexVt1ouq70UFTBpd3QttTsWB4NK/Rgf+S8THN9YofpR0cAPp0Wxk+vU9vQzJp4q+ThZgB846mXxjQPbRxnv8M64OZ6l3EIeLNrPjnfi9dLme1qHaOn8q045RR1uKHPSak+iDPGDjYFmN+HDIAsMGuKwKjG46PUT5wt9OSsXwdEgenNHXTnaEkMdRYW90UjnZ94QLjvanRWp/GNhqjl2bNa9cg6xwyS7Ss8562r7cK1tSH3kvnyC8WNUnKp8SjymyDlUdu5F5hV0P1Ouy24M8alEYTJrjfhHgBM9ylKe68OJ7xLwykZZJ818tZ5Bhq1eNs3",
    "iv": "fhNX0qfbztMbsjMJUMDYow=="
}
```

###### å“åº”æ•°æ®

* tokenï¼šå¾®ä¿¡å¸å·çš„å”¯ä¸€æ ‡è¯†openIdå€¼
* userInfoï¼šå¾®ä¿¡å¸å·æ•°æ®
  * idï¼šå¸å·åœ¨`t_wx_member`é‡Œçš„id
  * nickNameï¼šå¸å·æ˜µç§°
  * genderï¼šå¸å·çš„æ€§åˆ«
  * cityï¼šå¸å·çš„åŸå¸‚
  * provinceï¼šå¸å·çš„çœ
  * countryï¼šå¸å·çš„å›½å®¶
  * languageï¼šå¸å·çš„è¯­è¨€
  * createTimeï¼šå¸å·åœ¨é»‘é©¬é¢é¢ç³»ç»Ÿçš„æ³¨å†Œæ—¶é—´
  * openIdï¼šå¸å·çš„å”¯ä¸€æ ‡è¯†

```json
{
    "token": "otIbn5SclH6wr_pOilXPmdUqvDa0",
    "userInfo": {
        "city": "Shenzhen",
        "country": "China",
        "createTime": "2020-03-09 16:14:34.0",
        "gender": "1",
        "id": 6,
        "language": "zh_CN",
        "nickName": "åˆ˜é“¶æœ‹ğŸ’¯",
        "openId": "otIbn5SclH6wr_pOilXPmdUqvDa0",
        "province": "Guangdong"
    }
}
```

#### å®ç°

##### ä¿®æ”¹MySqlçš„å­—ç¬¦é›†

* å¦‚æœå¾®ä¿¡ç”¨æˆ·æ˜µç§°ä¸­æœ‰ç‰¹æ®Šå­—ç¬¦ï¼ˆæ¯”å¦‚ï¼šå«æœ‰emojiè¡¨æƒ…ï¼‰ï¼Œä½¿ç”¨utf-8å¯èƒ½æ— æ³•å­˜å‚¨ï¼Œç³»ç»Ÿä¼šæŠ¥é”™

* å¦‚æœæƒ³è¦å­˜å‚¨è¿™ç§æ•°æ®ï¼Œéœ€è¦æŠŠMySqlçš„å­—ç¬¦é›†ä¿®æ”¹æˆutf8mb4ï¼šutf8çš„è¶…é›†ï¼Œå…¼å®¹utf8ï¼Œæ”¯æŒæ›´å¤šå­—ç¬¦

* ä¿®æ”¹ä¹‹åï¼Œåœ¨Javaè¿æ¥æ•°æ®åº“æ—¶ï¼Œéœ€è¦è®¾ç½®è¿æ¥çš„å­—ç¬¦é›†  `characterEncoding=utf-8`

  ```properties
  jdbc.url=jdbc:mysql://localhost:3306/mm?characterEncoding=utf-8
  ```

* ä¿®æ”¹æ­¥éª¤ï¼š

  1. æ‰“å¼€MySqlå®‰è£…ç›®å½•ä¸­çš„my.ini

     ![image-20200310220614799](./æ€»img/æ¡†æ¶7/image-20200310220614799.png)

  2. æ‰¾åˆ°`[mysqld]`ä¸‹è¾¹çš„`character-set-server`ï¼Œä¿®æ”¹å€¼ä¸º`utf8mb4`

     * æ³¨æ„ï¼šåªè¦åœ¨`[mysqld]`ä¸‹æ‰¾åˆ°è¿™ä¸€é¡¹å³å¯ï¼Œå…¶å®ƒå†…å®¹å¦‚æœä¸åŒï¼Œæ— éœ€å…³æ³¨

     ![image-20200310220707923](./æ€»img/æ¡†æ¶7/image-20200310220707923.png)

  3. é‡å¯MySqlæœåŠ¡

     * ç®¡ç†å‘˜æ¨¡å¼è¿è¡Œcmd
     * å…ˆè¾“å…¥å‘½ä»¤ï¼š`net stop mysql`å…³é—­MySqlæœåŠ¡
     * å†è¾“å…¥å‘½ä»¤ï¼š`net start mysql`å¯åŠ¨MySqlæœåŠ¡

![image-20200402113421790](./æ€»img/æ¡†æ¶7/image-20200402113421790.png)

##### ä¿®æ”¹å°ç¨‹åºå‘å‘è¯·æ±‚çš„åœ°å€

![image-20200309161920252](./æ€»img/æ¡†æ¶7/image-20200309161920252-1601206121974.png)

##### `WxUtil`

* ä¿®æ”¹`WxUtil`ä¸­çš„ä¸¤ä¸ªé™æ€å˜é‡ï¼š
  * appidï¼šä½ çš„AppID
  * secretï¼šä½ çš„AppSecret

##### `WxMemberController`

* åˆ›å»º`WxMemberController`

```java
/**
 * @author liuyp
 * @date 2020/03/09
 */
@Controller
public class WxMemberController {
    private MemberService memberService = new MemberService();

    @RequestMapping("/member/login")
    public void login(HttpServletRequest request, HttpServletResponse response) throws IOException {
        try {
            //æ¥æ”¶å‚æ•°ï¼Œå°è£…æˆMap
            HashMap<String,String> map = JsonUtils.parseJSON2Object(request, HashMap.class);
            //å¾—åˆ°å¾®ä¿¡å°ç¨‹åºå‘æ¥çš„ä¸´æ—¶ç™»å½•å‡­è¯
            String code = map.get("code");
			
            //è°ƒç”¨å¾®ä¿¡å…¬ä¼—å¹³å°çš„APIï¼šæ‹¿codeæ¢å– ç”¨æˆ·å”¯ä¸€æ ‡è¯†openidå’Œä¼šè¯å¯†é’¥session_key
            JSONObject wx = WxUtil.get(code);
            String sessionKey = wx.getString("session_key");
            String openId = wx.getString("openid");

            //æ ¹æ®ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œå»æ•°æ®åº“t_wx_memberä¸­æŸ¥è¯¢å¾®ä¿¡ç”¨æˆ·ã€‚å¦‚æœæŸ¥åˆ°äº†ï¼Œè®¤ä¸ºæ˜¯å·²ç™»å½•
            WxMember wxMember = memberService.findByOpenId(openId);
            if (wxMember == null) {
                //è¯¥å¾®ä¿¡ç”¨æˆ·æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œè¦æŠŠè¯¥å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°t_wx_memberè¡¨ä¸­ï¼šæ³¨å†Œ
                
                //å¾—åˆ°å¾®ä¿¡å°ç¨‹åºæäº¤çš„åŠ å¯†æ•°æ®encryptedDataï¼Œä»¥åŠè§£å¯†å¿…é¡»çš„åç§»é‡iv
                String encryptedData = map.get("encryptedData");
                String iv = map.get("iv");
                //è°ƒç”¨å¾®ä¿¡å…¬ä¼—å¹³å°çš„APIï¼šè§£å¯†æ•°æ®ï¼Œå¾—åˆ°ç”¨æˆ·ä¿¡æ¯
                JSONObject userInfo = WxUtil.getUserInfo(encryptedData, sessionKey, iv);
                //æŠŠå¾—åˆ°çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè½¬æ¢æˆWxMemberå¯¹è±¡ï¼›ç„¶åä¿å­˜åˆ°æ•°æ®åº“t_wx_memberè¡¨é‡Œ
                wxMember = userInfo.toJavaObject(WxMember.class);
                wxMember.setCreateTime(DateUtils.parseDate2String(new Date()));
                memberService.register(wxMember);
            }

            //å‡†å¤‡ è¦å“åº”çš„æ•°æ®ã€‚tokeyï¼šå€¼æ˜¯ç”¨æˆ·å”¯ä¸€æ ‡è¯†openidï¼ŒuserInfoï¼šæ˜¯ç™»å½•çš„å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯
            HashMap<String,Object> resultMap = new HashMap();
            resultMap.put("token", openId);
            resultMap.put("userInfo", wxMember);

            JsonUtils.printResult(response, resultMap);
        } catch (Exception e) {
            e.printStackTrace();
            JsonUtils.printResult(response, null);
        }
    }
}
```

##### `MemberService`

* åˆ›å»º`MemberService`

```java
/**
 * @author liuyp
 * @date 2020/03/09
 */
public class MemberService {
    public WxMember findByOpenId(String openId) throws IOException {
        SqlSession session = SqlSessionFactoryUtils.openSqlSession();
        WxMemberDao memberDao = session.getMapper(WxMemberDao.class);
        WxMember wxMember = memberDao.findByOpenId(openId);
        SqlSessionFactoryUtils.commitAndClose(session);
        return wxMember;
    }

    public void register(WxMember wxMember) throws IOException {
        SqlSession session = SqlSessionFactoryUtils.openSqlSession();
        WxMemberDao memberDao = session.getMapper(WxMemberDao.class);
        memberDao.add(wxMember);
        SqlSessionFactoryUtils.commitAndClose(session);
    }
}
```

##### `WxMemberDao`

* åˆ›å»ºæ˜ å°„å™¨`WxMemberDao`

```java
/**
 * @author liuyp
 * @date 2020/03/09
 */
public interface WxMemberDao {
    WxMember findByOpenId(String openId);

    void add(WxMember wxMember);
}
```

* åˆ›å»ºæ˜ å°„æ–‡ä»¶`WxMemberDao.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.mm.dao.WxMemberDao">
    <select id="findByOpenId" parameterType="String" resultMap="wxMemberMap">
        select * from t_wx_member where open_id = #{openId}
    </select>
    <resultMap id="wxMemberMap" type="WxMember">
        <id property="id" column="id"/>
        <result property="nickName" column="nick_name"/>
        <result property="openId" column="open_id"/>
        <result property="unionId" column="union_id"/>
        <result property="createTime" column="create_time"/>
        <result property="courseId" column="course_id"/>
        <result property="cityId" column="city_id"/>
        <result property="lastCategoryKind" column="last_category_kind"/>
        <result property="lastCategoryType" column="last_category_type"/>
        <result property="lastCategoryId" column="last_category_id"/>
        <result property="lastQuestionId" column="last_question_id"/>
    </resultMap>

    <insert id="add" parameterType="WxMember">
        <selectKey resultType="int" keyProperty="id" order="AFTER">
            select last_insert_id()
        </selectKey>
        insert into t_wx_member (
                         nick_name,
                         avatar_url,
                         gender,
                         city,
                         province,
                         country,
                         language,
                         open_id,
                         union_id,
                         create_time)
        values (
                       #{nickName},
                       #{avatarUrl},
                       #{gender},
                       #{city},
                       #{province},
                       #{country},
                       #{language},
                       #{openId},
                       #{unionId},
                       #{createTime});
    </insert>
</mapper>
```

#### å°ç»“

